<head>
	<link rel="stylesheet" type="text/css" href="gridster.css">
	<script src="jquery.js"></script>
	<script src="gridster.js"></script>
	<script src="stack.js"></script>
</head>
<body>
	<div class="gridster">
    <ul>
        <li data-row="1" data-col="1" data-sizex="1" data-sizey="1"><textarea id="code">,>,[<+>-]<.</textarea></li>
        <li data-row="2" data-col="1" data-sizex="1" data-sizey="1"><textarea id="input"></textarea></li>
        <li data-row="3" data-col="1" data-sizex="1" data-sizey="1"><textarea id="output"></textarea></li>

    </ul>
</div>
    <script type="text/javascript">
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
    </script>

    <script type="text/javascript">
      var gridster;

      $(function(){

        gridster = $(".gridster ul").gridster({
          widget_base_dimensions: [100, 55],
          widget_margins: [5, 5],
          helper: 'clone',
          resize: {
            enabled: true
          }
        }).data('gridster');


        $('.js-resize-random').on('click', function() {
            gridster.resize_widget(gridster.$widgets.eq(getRandomInt(0, 9)),
                getRandomInt(1, 4), getRandomInt(1, 4))
        });

      });
      </script>

	<br /><button id="execute">Execute</button>

	<br />data: <canvas id="dataview"></canvas>

	<script>
		
		
		var data = [0];
		var data_ptr = 0;
		drawData();
		var callstack = new Stack();

		
		function doItUp(){
			data = [0];
			data_ptr = 0;
			var MAX_INSTRUCTIONS = 2500;

			var script = document.getElementById("code").value;
			var script_ptr = 0;
			var instruction_ctr = 0;
			
			var brackets = 0;
			
			while(script_ptr < script.length && instruction_ctr < MAX_INSTRUCTIONS) {
				switch(script.charAt(script_ptr)) {
					case ">":
						if(data_ptr == data.length - 1){
							var len = data.length;
							for(var i = 0; i < len; i++){
								data[data.length + i] = 0;
							}
						}
						data_ptr++;
						break; 
					case "<":
						data_ptr--;
						break;
					case "+":
						data[data_ptr]++;
						break;
					case "-":
						data[data_ptr]--;
						break;
					case ",":
						data[data_ptr] = parseInt(prompt("input: "));
						break;
					case ".":
						alert(data[data_ptr]);
						break;
					case "[":
						if(data[data_ptr] == 0) {
							//skip to associated closing bracket.
							var braces = 0;
							while(script_ptr < script.length && script.charAt(script_ptr) != "]" && braces != 0) {
								script_ptr++;
								if(script.charAt(script_ptr) == "[") braces++;
								if(script.charAt(script_ptr) == "]") braces--;
							}
						} else {
							callstack.push(script_ptr);
						}
						break;
					case "]":
						if(data[data_ptr] == 0) {
							callstack.pop();
						} else {
							script_ptr = callstack.peek();
						}
						break;
					default:
				}
				script_ptr++;
				drawData();
				instruction_ctr++;
			}
		}
		
		function drawData(){
			var canvas = document.getElementById("dataview");
			var context = canvas.getContext("2d");
			
			//rows and columns
			var cols = data.length;
			var rows = 1;
			//square size
			var ss = 25;
			//grid width and height
			var bw = ss*cols;
			var bh = ss*rows;
			
			//size of canvas
			var cw = bw + 1;
			var ch = bh + 1;
			
			canvas.width = cw;
			canvas.height = ch + 20;
								
			for (var x = 0; x <= bw; x += ss) {
				context.moveTo(0.5 + x, 0);
				context.lineTo(0.5 + x, bh);
			}
			
			
			for (var x = 0; x <= bh; x += ss) {
				context.moveTo(0, 0.5 + x);
				context.lineTo(bw, 0.5 + x);
			}
			
			context.strokeStyle = "black";
			context.stroke();
			
			context.fillStyle = "black";
			context.font = "30px Arial";
			for(var i = 0; i < rows; i++){
				for(var j = 0; j < cols; j++){
					context.fillText("" + data[j], j*ss, i*ss+20);
				}
			}
			context.fillText("^", data_ptr*ss, ss + 30);
		}
		
		document.getElementById("execute").addEventListener("click", doItUp);
		
		</script>
</body>

